
//**********************************************************************************
//
// Расчет контрольных сумм
// 
//**********************************************************************************

#include "crc16.h"

uint16_t crctable[256];

//**********************************************************************************
// Расчет таблицы
//**********************************************************************************
void MakeCRC16Table( void ) {
    
    uint16_t r, j;
    for ( int i = 0; i < 256; i++ ) {
        r = ( (uint16_t)i ) << 8;
        for ( j = 0; j < 8; j++ ) {
            if ( r & ( 1 << 15 ) ) 
                r = ( r << 1 ) ^ 0x8005;
            else r = r << 1;
         }
        crctable[i] = r;
     }
 }

//**********************************************************************************
// Расчет контрольной суммы
//**********************************************************************************
uint16_t GetCRC16( uint8_t *buf, uint16_t len ) {
    
    uint16_t crc;
        
    crc = 0xFFFF;
    while ( len-- )
        crc = crctable[((crc>>8)^*buf++)&0xFF] ^ (crc<<8);
    crc ^= 0xFFFF;
    return crc;
}

